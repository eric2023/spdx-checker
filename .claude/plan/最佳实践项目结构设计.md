# SPDX Scanner 最佳实践项目结构设计

## 设计原则

### 1. Python项目标准
- 遵循Python Packaging User Guide
- 符合PEP 8命名规范
- 采用现代Python项目结构

### 2. 模块化设计
- 按功能模块分组
- 清晰的职责分离
- 最小化模块间耦合

### 3. 可维护性
- 易于导航的目录结构
- 统一的文件命名规范
- 良好的可扩展性

## 新项目结构设计

```
spdx-scanner/                          # 项目根目录
├── .github/                           # GitHub配置
│   └── workflows/
│       ├── ci.yml                     # CI/CD配置
│       └── release.yml                # 发布工作流
├── src/                               # 源代码目录
│   └── spdx_scanner/                  # 主包
│       ├── __init__.py
│       ├── __main__.py
│       ├── cli/                       # CLI模块
│       │   ├── __init__.py
│       │   ├── commands/              # 命令子模块
│       │   │   ├── __init__.py
│       │   │   ├── scan.py            # scan命令
│       │   │   ├── correct.py         # correct命令
│       │   │   └── hook.py           # hook命令
│       │   ├── formatters/            # 输出格式化
│       │   │   ├── __init__.py
│       │   │   ├── text.py
│       │   │   ├── json.py
│       │   │   ├── html.py
│       │   │   ├── markdown.py
│       │   │   └── csv.py
│       │   └── cli.py                 # 主CLI接口
│       ├── core/                      # 核心业务逻辑
│       │   ├── __init__.py
│       │   ├── scanner.py             # 文件扫描器
│       │   ├── parser.py             # SPDX解析器
│       │   ├── validator.py          # 许可证验证器
│       │   └── corrector.py          # 许可证修正器
│       ├── io/                        # 输入输出处理
│       │   ├── __init__.py
│       │   ├── reporter.py            # 报告生成器
│       │   └── file_handler.py       # 文件处理工具
│       ├── config/                    # 配置管理
│       │   ├── __init__.py
│       │   ├── settings.py           # 配置设置
│       │   ├── loader.py             # 配置加载器
│       │   └── validation.py         # 配置验证
│       ├── models/                    # 数据模型
│       │   ├── __init__.py
│       │   ├── base.py               # 基础模型
│       │   ├── spdx.py               # SPDX相关模型
│       │   └── validation.py         # 验证相关模型
│       └── utils/                     # 工具模块
│           ├── __init__.py
│           ├── git_integration.py    # Git集成
│           ├── file_utils.py         # 文件工具
│           ├── path_utils.py         # 路径工具
│           ├── logging_config.py     # 日志配置
│           └── exceptions.py         # 异常定义
├── tests/                             # 测试目录
│   ├── __init__.py
│   ├── conftest.py                   # pytest配置
│   ├── unit/                         # 单元测试
│   │   ├── __init__.py
│   │   ├── test_scanner.py
│   │   ├── test_parser.py
│   │   ├── test_validator.py
│   │   ├── test_corrector.py
│   │   ├── test_reporter.py
│   │   └── test_config.py
│   ├── integration/                  # 集成测试
│   │   ├── __init__.py
│   │   ├── test_cli_integration.py
│   │   ├── test_workflow.py
│   │   └── test_git_integration.py
│   ├── fixtures/                     # 测试数据
│   │   ├── __init__.py
│   │   ├── sample_files.py
│   │   └── test_data.py
│   └── utils/                        # 测试工具
│       ├── __init__.py
│       ├── test_helpers.py
│       └── mocks.py
├── docs/                             # 文档目录
│   ├── index.md                      # 文档主页
│   ├── README.md                     # 项目README
│   ├── installation.md               # 安装指南
│   ├── usage/                        # 使用说明
│   │   ├── index.md
│   │   ├── basic-usage.md
│   │   ├── configuration.md
│   │   ├── git-integration.md
│   │   └── advanced-features.md
│   ├── development/                  # 开发文档
│   │   ├── contributing.md
│   │   ├── architecture.md
│   │   ├── testing.md
│   │   └── deployment.md
│   ├── api/                          # API文档
│   │   ├── index.md
│   │   ├── cli.md
│   │   ├── core.md
│   │   ├── models.md
│   │   └── utils.md
│   └── examples/                     # 示例文档
│       ├── basic-scan.md
│       ├── correction-example.md
│       └── custom-configuration.md
├── examples/                         # 示例代码
│   ├── basic_usage.py               # 基本使用示例
│   ├── configuration_example.py     # 配置示例
│   ├── git_hook_example.py         # Git钩子示例
│   └── custom_formatter_example.py  # 自定义格式器示例
├── scripts/                          # 脚本目录
│   ├── install.sh                   # 安装脚本
│   ├── setup_dev_env.sh            # 开发环境设置
│   ├── run_tests.sh                # 测试脚本
│   ├── build_docs.sh               # 文档构建脚本
│   └── release.sh                  # 发布脚本
├── tools/                            # 工具目录
│   ├── migration/                   # 迁移工具
│   │   ├── __init__.py
│   │   ├── file_mover.py
│   │   └── refactor.py
│   ├── analysis/                    # 分析工具
│   │   ├── __init__.py
│   │   ├── code_quality.py
│   │   └── dependency_analyzer.py
│   └── maintenance/                 # 维护工具
│       ├── __init__.py
│       ├── cleanup.py
│       └── dependency_checker.py
├── .github/                          # GitHub配置
│   ├── ISSUE_TEMPLATE/
│   ├── PULL_REQUEST_TEMPLATE.md
│   └── workflows/
│       ├── ci.yml
│       ├── docs.yml
│       └── release.yml
├── .gitignore                       # Git忽略文件
├── .pre-commit-config.yaml         # 预提交钩子
├── pyproject.toml                   # 项目配置
├── requirements.txt                # 生产依赖
├── requirements-dev.txt            # 开发依赖
├── requirements-test.txt           # 测试依赖
├── tox.ini                         # 测试配置
├── Makefile                        # 构建脚本
└── README.md                       # 项目说明
```

## 详细设计说明

### 1. 源代码结构 (src/)

#### 1.1 CLI模块 (cli/)
```
cli/
├── commands/       # 命令实现
├── formatters/     # 输出格式化
└── cli.py         # 主入口点
```

**设计理念**:
- 命令和格式化逻辑分离
- 易于扩展新命令
- 支持多种输出格式

#### 1.2 核心业务逻辑 (core/)
```
core/
├── scanner.py     # 文件扫描
├── parser.py      # SPDX解析
├── validator.py   # 许可证验证
└── corrector.py   # 许可证修正
```

**设计理念**:
- 保持核心功能的高内聚
- 清晰的职责分工
- 便于单元测试

#### 1.3 输入输出处理 (io/)
```
io/
├── reporter.py     # 报告生成
└── file_handler.py # 文件处理工具
```

**设计理念**:
- 分离I/O逻辑和业务逻辑
- 统一文件处理接口
- 支持多种报告格式

#### 1.4 配置管理 (config/)
```
config/
├── settings.py    # 配置设置
├── loader.py      # 配置加载
└── validation.py  # 配置验证
```

**设计理念**:
- 配置与业务逻辑分离
- 支持多种配置源
- 配置验证和错误处理

#### 1.5 数据模型 (models/)
```
models/
├── base.py        # 基础模型
├── spdx.py        # SPDX相关模型
└── validation.py  # 验证相关模型
```

**设计理念**:
- 按功能领域分组模型
- 清晰的继承层次
- 类型安全的数据结构

#### 1.6 工具模块 (utils/)
```
utils/
├── git_integration.py    # Git集成
├── file_utils.py        # 文件工具
├── path_utils.py        # 路径工具
├── logging_config.py    # 日志配置
└── exceptions.py        # 异常定义
```

**设计理念**:
- 通用工具函数和类
- 统一的异常处理
- 标准化的日志配置

### 2. 测试结构 (tests/)

#### 2.1 单元测试 (tests/unit/)
- 按模块划分测试文件
- 每个源代码模块对应一个测试文件
- 高测试覆盖率要求

#### 2.2 集成测试 (tests/integration/)
- 测试模块间交互
- 端到端工作流测试
- 模拟真实使用场景

#### 2.3 测试工具 (tests/fixtures/, tests/utils/)
- 测试数据和夹具
- 测试辅助工具和mock对象
- 可重用的测试组件

### 3. 文档结构 (docs/)

#### 3.1 用户文档 (docs/usage/)
- 安装和使用指南
- 配置说明
- 高级功能介绍

#### 3.2 开发文档 (docs/development/)
- 贡献指南
- 架构设计文档
- 测试策略
- 部署指南

#### 3.3 API文档 (docs/api/)
- 完整的API参考
- 模块文档
- 示例代码

### 4. 工具和脚本 (tools/, scripts/)

#### 4.1 迁移工具 (tools/migration/)
- 自动文件迁移
- 代码重构工具
- 依赖分析

#### 4.2 分析工具 (tools/analysis/)
- 代码质量检查
- 依赖关系分析
- 性能分析

#### 4.3 构建脚本 (scripts/)
- 开发环境设置
- 测试运行
- 文档构建
- 发布流程

## 迁移策略

### 第一阶段：准备工作
1. 创建新目录结构
2. 设置Git分支保护
3. 准备回滚方案

### 第二阶段：文件迁移
1. 按模块迁移源代码
2. 迁移测试文件
3. 迁移文档文件

### 第三阶段：配置更新
1. 更新pyproject.toml
2. 更新CI/CD配置
3. 更新构建脚本

### 第四阶段：验证测试
1. 运行所有测试
2. 验证功能完整性
3. 检查性能影响

## 优势分析

### 1. 可维护性 ✅
- 清晰的文件组织
- 易于导航的目录结构
- 统一的命名规范

### 2. 可扩展性 ✅
- 模块化设计
- 插件友好的架构
- 易于添加新功能

### 3. 可测试性 ✅
- 清晰的测试组织
- 易于mock和stub
- 支持多种测试策略

### 4. 文档化 ✅
- 完整的文档结构
- 分离的用户和开发文档
- 便于维护的文档组织

### 5. 协作友好 ✅
- 符合开源项目标准
- 易于新开发者上手
- 标准的开发工作流

## 实施时间表

| 阶段 | 工作内容 | 预计时间 |
|------|----------|----------|
| 准备 | 创建新结构、设置分支 | 0.5天 |
| 迁移 | 文件迁移、依赖更新 | 1.5天 |
| 验证 | 测试运行、功能验证 | 1天 |
| 优化 | 性能调优、文档完善 | 0.5天 |

**总计**: 3.5个工作日

---

**设计完成时间**: 2025年10月28日
**设计版本**: v1.0
**适用范围**: SPDX Scanner项目重构